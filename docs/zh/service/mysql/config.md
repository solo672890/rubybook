---
releaseTime: 2023/7/1
original: true
prev: false
next: false
sidebar: false
comment: false  
---

# MySQLæœåŠ¡å™¨é…ç½®
> æœåŠ¡å™¨é…ç½®: 8æ ¸å†…å­˜ , 100G_SSD , 4æ ¸CPU
> 
> ç›®æ ‡: æ¯å¤©50ä¸‡è®¢å•å†™å…¥

## ğŸ‘‰[MySQLæ…¢æŸ¥è¯¢](/service/mysql/mysql-slow)


## å®Œæ•´é…ç½®

::: warning
è¿™ä»½é…ç½®æ˜¯æŒ‰ç…§mysqlæœåŠ¡å™¨é…ç½®æ¥å®šåˆ¶çš„,æ‰€è°“mysqlæœåŠ¡å™¨å³åªæœ‰mysqlä½œä¸ºæœåŠ¡,å¹¶ä¸åŒ…å«å…¶ä»–å·¥å…·(redis,kafkaç­‰)è¿è¡Œ,é¿å…ç³»ç»Ÿå†…å­˜,ç¡¬ç›˜,è°ƒåº¦ç«äº‰.

å¦‚æœæ˜¯émysqlæœåŠ¡å™¨,æ¯”å¦‚lnmpç³»ç»Ÿ,åˆ™åŒæ ·çš„ç³»ç»Ÿé…ç½®ä¸‹,è¦æŠŠè¿™ä»½mysqlé‡Œçš„é…ç½®å¤§å°å‡åŠ
:::

::: details 
````shell
sudo mkdir -p /var/log/mysql && sudo chown mysql:mysql /var/log/mysql 
sudo touch /var/log/mysql/mysql-slow.log && chmod 640 /var/log/mysql/mysql-slow.log
````
````shell
[mysqld]

# =========================
# InnoDB æ ¸å¿ƒé…ç½®ï¼ˆå†…å­˜ä¼˜åŒ–ï¼‰
# =========================
innodb_buffer_pool_size = 4.5G                 # 8GBå†…å­˜åˆ†é…4.5Gç»™InnoDBç¼“å­˜
innodb_buffer_pool_instances = 4             # ç¼“å†²æ± å®ä¾‹æ•° = CPUæ ¸æ•°
innodb_log_file_size = 1G                    # å¢å¤§æ—¥å¿—æ–‡ä»¶å‡å°‘æ£€æŸ¥ç‚¹é¢‘ç‡
innodb_log_files_in_group = 2                # æ—¥å¿—æ–‡ä»¶æ•°
innodb_redo_log_capacity = 2G                # MySQL 8.4+ æ¨èé…ç½®ï¼ˆè¦†ç›–æ—§å‚æ•°ï¼‰
innodb_flush_log_at_trx_commit = 1           # æŠ˜ä¸­é…ç½®ï¼šæ¯ç§’åˆ·ç›˜ï¼Œæ€§èƒ½ä¸å®‰å…¨å¹³è¡¡
innodb_log_buffer_size = 256M                 # æ—¥å¿—ç¼“å†²åŒºå¤§å°
innodb_io_capacity = 2000                    # SSDä¼˜åŒ–ï¼ˆé»˜è®¤200ï¼ŒSSDå¯è®¾2000ï¼‰
innodb_io_capacity_max = 4000                # æœ€å¤§I/Oå®¹é‡ï¼ˆSSDå¯ç”¨4000ï¼‰
innodb_flush_method = O_DIRECT               # ç›´æ¥IOï¼Œå‡å°‘å†…å­˜æ‹·è´
innodb_adaptive_hash_index = ON              # è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ï¼ˆMySQL 8.4é»˜è®¤å…³é—­ï¼‰

# =========================
# è¿æ¥ä¸ç¼“å­˜é…ç½®
# =========================
max_connections = 250                        # æœ€å¤§è¿æ¥æ•°ï¼ˆæ ¹æ®å®é™…è´Ÿè½½è°ƒæ•´ï¼‰
back_log = 100                               # ç­‰å¾…è¿æ¥é˜Ÿåˆ—
table_open_cache = 4000                      # æ‰“å¼€è¡¨ç¼“å­˜
table_definition_cache = 2000                # è¡¨å®šä¹‰ç¼“å­˜
thread_cache_size = 100                      # çº¿ç¨‹ç¼“å­˜
tmp_table_size = 128M                        # å†…å­˜ä¸´æ—¶è¡¨å¤§å°
max_heap_table_size = 128M                   # ç”¨æˆ·ä¼šè¯ä¸´æ—¶è¡¨å¤§å°
skip-name-resolve                            # ç¦æ­¢DNSè§£æï¼Œæå‡è¿æ¥é€Ÿåº¦
wait_timeout = 300                           # ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
interactive_timeout = 300                    # äº¤äº’å¼è¿æ¥è¶…æ—¶æ—¶é—´

# =========================
# æŸ¥è¯¢ä¸äº‹åŠ¡é…ç½®
# =========================
sort_buffer_size = 2M                      # æ¯ä¸ªæ’åºç¼“å†²åŒºå¤§å°
join_buffer_size = 2M                      # æ¯ä¸ªJOINç¼“å†²åŒºå¤§å°
read_buffer_size = 2M                      # é¡ºåºè¯»å–ç¼“å†²åŒº
read_rnd_buffer_size = 2M                  # éšæœºè¯»å–ç¼“å†²åŒº
binlog_format = ROW                        # äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ï¼ˆROWæ›´å®‰å…¨ï¼‰
sync_binlog = 1                            # æ¯äº‹åŠ¡åŒæ­¥æ—¥å¿—ï¼ˆå®‰å…¨ä¼˜å…ˆï¼‰
binlog_row_image = MINIMAL                 # å‡å°‘äºŒè¿›åˆ¶æ—¥å¿—ä½“ç§¯
binlog_expire_logs_seconds = 604800        # ä¿ç•™äºŒè¿›åˆ¶æ—¥å¿—7å¤©
log_bin = mysql-bin                        # å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆä¸»ä»å¤åˆ¶ï¼‰
log_replica_updates  = 1                   # ä»åº“æ›´æ–°æ—¥å¿—ï¼ˆä¸»ä»é“¾ï¼‰
gtid_mode = ON                             # GTIDæ¨¡å¼ï¼ˆä¸»ä»ä¸€è‡´æ€§ï¼‰
enforce_gtid_consistency = ON              # å¼ºåˆ¶GTIDä¸€è‡´æ€§

# =========================
# ç£ç›˜ä¸æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ–
# =========================
default_tmp_storage_engine = MEMORY        # ä¸´æ—¶è¡¨ä½¿ç”¨å†…å­˜å¼•æ“
innodb_max_dirty_pages_pct = 50            # è„é¡µæ¯”ä¾‹ï¼ˆ50%å¹³è¡¡åˆ·æ–°é¢‘ç‡ï¼‰
innodb_max_dirty_pages_pct_lwm = 10        # è„é¡µä½æ°´ä½çº¿
innodb_purge_threads = 4                   # æ¸…ç†çº¿ç¨‹æ•°ï¼ˆCPUæ ¸æ•°ï¼‰
innodb_change_buffer_max_size = 25         # ä¿®æ”¹ç¼“å†²åŒºå¤§å°ï¼ˆSSDå¯è°ƒä½ï¼‰
innodb_doublewrite = ON                    # åŒå†™ç¼“å†²ï¼ˆä¿æŠ¤æ•°æ®ï¼‰


# =========================
# å®‰å…¨ä¸ç›‘æ§
# =========================
log_output=FILE
slow_query_log = ON                           # æ…¢æŸ¥è¯¢æ—¥å¿—
slow_query_log_file = /var/log/mysql/mysql-slow.log
long_query_time = 0.5                         # è¶…è¿‡0.5ç§’è®°å½•æ…¢æŸ¥è¯¢
log_queries_not_using_indexes = ON            # è®°å½•æœªä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢
general_log = 0                               # å…³é—­é€šç”¨æ—¥å¿—ï¼ˆæ€§èƒ½å¼€é”€å¤§ï¼‰
# æ¯åˆ†é’Ÿæœ€å¤šè®°å½•10æ¡æœªä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢,é˜²æ­¢æ—¥å¿—çˆ†ç‚¸
log_throttle_queries_not_using_indexes = 10 
log_slow_slave_statements = ON                # è®°å½•é”ç­‰å¾…æ—¶é—´è¶…è¿‡é˜ˆå€¼çš„æŸ¥è¯¢
````
:::

## é…ç½®è§£é‡Š

### innodb_buffer_pool_size 
[MySQL innodb_buffer_pool_sizeå†…å­˜è°ƒä¼˜](https://cloud.tencent.com/developer/article/2537460)

>ç”¨äºç¼“å­˜æ•°æ®å’Œç´¢å¼•çš„å†…å­˜å¤§å°,å‡å°‘ç£ç›˜ I/Oï¼Œæå‡æŸ¥è¯¢é€Ÿåº¦.
>å¦‚æœæœåŠ¡å™¨åªåšæ•°æ®åº“æœåŠ¡,æœ€å¤šè®¾ç½®åˆ°å†…å­˜çš„60%,å¦åˆ™è®¾ç½®30%å³å¯,
> è¿‡å¤§çš„buffer poolå¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒ,å†…å­˜å ç”¨ä¹Ÿä¼šè¶…å‡ºé¢„æœŸ
>è¯¥å‚æ•°ä¸è¦ä¹±è®¾ç½®,å¦‚æœmysqlå’Œå…¶ä»–æœåŠ¡åŒå¤„äºä¸€å°linuxä¸Š,åˆ™ä¸è¦è®¾ç½®è¿‡å¤§,å› ä¸ºæˆ‘å·²ç»å´©æºƒè¿‡.
>æœ¬äººå¤šæ¬¡æµ‹è¯•,8Gå†…å­˜,æœ€å¤šåªèƒ½å°†å®ƒè®¾ç½®ä¸º5G,å¤šäº†è¦è¶…å‡ºå†…å­˜
>InnoDB ä¸æ˜¯æ¯æ¬¡è¯»å†™éƒ½ç›´æ¥æ“ä½œç£ç›˜ï¼Œè€Œæ˜¯é€šè¿‡è¿™ä¸ªå†…å­˜ç¼“å†²æ± æ¥ç¼“å­˜ï¼š
>1. æ•°æ®é¡µï¼ˆData Pagesï¼‰ï¼šè¡¨ä¸­çš„è¡Œæ•°æ®ã€‚
>1. ç´¢å¼•é¡µï¼ˆIndex Pagesï¼‰ï¼šB+æ ‘ç´¢å¼•ç»“æ„ã€‚
>1. å…¶ä»–å†…éƒ¨ç»“æ„ï¼šå¦‚é”ä¿¡æ¯ã€è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ç­‰

### innodb_buffer_pool_instances 

>**ä½œç”¨:**  é…åˆ `innodb_buffer_pool_size`,å‡å°‘ Buffer Pool é”äº‰ç”¨ï¼Œæå‡å¹¶å‘æ€§èƒ½
>
>::: warning å®˜æ–¹å»ºè®®
>æ¯ä¸ªå®ä¾‹è‡³å°‘ 1GBï¼Œå¦åˆ™æ€§èƒ½å¯èƒ½ä¸‹é™
>:::
>
>**âœ…å¦‚ä½•å·¥ä½œ**
>
>**å‡è®¾:** innodb_buffer_pool_size = 8G  innodb_buffer_pool_instances = 8
>
>é‚£ä¹ˆï¼š
>
>* æ¯ä¸ªå®ä¾‹å¤§å° = 8G / 8 = 1GB
>* æ¯ä¸ªå®ä¾‹ç‹¬ç«‹ç®¡ç†è‡ªå·±çš„æ•°æ®é¡µã€LRU é“¾è¡¨ã€é”ç­‰
>* çº¿ç¨‹è®¿é—®æ•°æ®æ—¶ï¼Œæ ¹æ®â€œé¡µçš„å“ˆå¸Œå€¼â€å†³å®šä½¿ç”¨å“ªä¸ªå®ä¾‹
>* ğŸ” å“ˆå¸Œç®—æ³•ï¼šInnoDB ä½¿ç”¨é¡µçš„è¡¨ç©ºé—´ ID å’Œé¡µå·è¿›è¡Œå“ˆå¸Œï¼Œå†³å®šè¯¥é¡µå±äºå“ªä¸ªå®ä¾‹ã€‚
>
>**âœ…æ¨èé…ç½®åŸåˆ™**
>
>| æ•°æ®åº“è§„æ¨¡ | æ¨èæ¯”ä¾‹ |  è®¡ç®—ç¤ºä¾‹   |
> |:-----:|:----:|:-------:|
>| 8GBå†…å­˜ | <60% | < 4.5GB |
>| 16GB  | 60%  |  10GB   |
>| >32GB | 70%  |  >22GB  | 

### innodb_log_file_size 
> ````
> æŸ¥è¯¢åŠ¨æ€å€¼
>SELECT @@innodb_log_file_size AS innodb_log_file_size_bytes,
>ROUND(@@innodb_log_file_size / (1024*1024*1024), 2) AS innodb_log_file_size_GB;
> ````
>**ğŸ“Œä½œç”¨**
> * æ§åˆ¶InnoDB redlogæ–‡ä»¶å¤§å°,å½±å“`å†™æ€§èƒ½ã€æ¢å¤æ—¶é—´ã€å¹¶å‘èƒ½åŠ›`
> * InnoDB é€šå¸¸æœ‰å¤šä¸ªæ—¥å¿—æ–‡ä»¶ï¼ˆé»˜è®¤æ˜¯ 2 ä¸ªï¼‰ï¼Œç”± innodb_log_files_in_group æ§åˆ¶ã€‚
> * total redlogæ—¥å¿—ç©ºé—´ = innodb_log_file_size Ã— innodb_log_files_in_group
>
>**âœ…æ ¸å¿ƒä½œç”¨:** 
> 
> å³ä½¿MySQLå´©æºƒ,åªè¦Redo Logè¿˜åœ¨ï¼Œå°±å¯ä»¥é€šè¿‡Redo Logæ¥æ¢å¤æœªå†™å…¥ç£ç›˜çš„æ•°æ®
>InnoDB ä½¿ç”¨ é‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰ æ¥ä¿è¯äº‹åŠ¡çš„ æŒä¹…æ€§ï¼ˆDurabilityï¼‰ å’Œ å´©æºƒæ¢å¤èƒ½åŠ›ã€‚
>* å½“ä½ æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡ï¼ˆå¦‚INSERT,UPDATE,DELETEï¼‰,InnoDB ä¼šå…ˆå°†è¿™äº›æ›´æ”¹å†™å…¥é‡åšæ—¥å¿—ç¼“å†²åŒºï¼ˆredo log bufferï¼‰ã€‚
>* ç„¶åï¼Œè¿™äº›æ—¥å¿—ä¼šè¢«å†™å…¥ç£ç›˜ä¸Šçš„ é‡åšæ—¥å¿—æ–‡ä»¶ï¼ˆredo log filesï¼‰
>* æœ€ç»ˆï¼Œæ•°æ®é¡µçš„æ›´æ”¹ä¼šå¼‚æ­¥å†™å…¥è¡¨ç©ºé—´ï¼ˆ.ibd æ–‡ä»¶ï¼‰ã€‚
>
>**ğŸ“Œä¸ºä»€ä¹ˆè¿™ä¸ªå‚æ•°å¾ˆé‡è¦ï¼Ÿ** 
> 1. **å½±å“å†™æ€§èƒ½**
> * è¾ƒå¤§çš„æ—¥å¿—æ–‡ä»¶æ„å‘³ç€ InnoDB å¯ä»¥åœ¨ä¸é¢‘ç¹â€œæ£€æŸ¥ç‚¹ï¼ˆcheckpointï¼‰â€çš„æƒ…å†µä¸‹ç¼“å­˜æ›´å¤šä¿®æ”¹ã€‚
> * å‡å°‘ç£ç›˜ I/Oï¼Œæé«˜ INSERT/UPDATE çš„ååé‡ã€‚
> * ä½†ä¹Ÿä¸èƒ½å¤ªå¤§ï¼Œå¦åˆ™æ¢å¤æ—¶é—´ä¼šå˜é•¿ã€‚
> 2. **å½±å“å´©æºƒæ¢å¤æ—¶é—´**
> * æ—¥å¿—è¶Šå¤§ï¼Œå´©æºƒåéœ€è¦é‡æ”¾çš„æ—¥å¿—è¶Šå¤šï¼Œæ¢å¤æ—¶é—´è¶Šé•¿ã€‚
> * ä¾‹å¦‚ï¼š1GB æ—¥å¿—å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ¢å¤ï¼Œè€Œ 128MB å¯èƒ½åªéœ€å‡ ç§’ã€‚
> 3. **å½±å“äº‹åŠ¡å¹¶å‘èƒ½åŠ›**
> * å¤§æ—¥å¿—æ–‡ä»¶æ”¯æŒæ›´é«˜çš„å¹¶å‘å†™å…¥ï¼Œå› ä¸ºæ—¥å¿—ç©ºé—´æ›´å……è¶³ï¼Œä¸å®¹æ˜“â€œæ—¥å¿—æ»¡â€è€Œé˜»å¡å†™æ“ä½œã€‚
>
>**âœ…æ¨èé…ç½®åŸåˆ™**
>
>| åœºæ™¯ |    å»ºè®®å€¼    |
> |:---------------:|:-------------:|
>|   å°å‹åº”ç”¨ï¼ˆå¼€å‘/æµ‹è¯•ï¼‰    |       64M ~ 128M      |
>|    ä¸­å‹åº”ç”¨ï¼ˆç”Ÿäº§ï¼Œä¸€èˆ¬è´Ÿè½½ï¼‰    |       256M ~ 512M       | 
>|      å¤§å‹åº”ç”¨ï¼ˆé«˜å¹¶å‘å†™å…¥ï¼‰      | 1G ~ 2G | 
>|      è¶…å¤§å‹åº”ç”¨ï¼ˆOLTPï¼Œé«˜ååï¼‰      | 4Gï¼ˆéœ€è°¨æ…ï¼‰ | 
>
> **ğŸ“Œå¸¸è§é—®é¢˜**
> 
>**â“ä¸ºä»€ä¹ˆä¸èƒ½åŠ¨æ€ä¿®æ”¹ï¼Ÿ**
> 
>* å› ä¸ºæ—¥å¿—æ–‡ä»¶å¤§å°åœ¨å®ä¾‹å¯åŠ¨æ—¶å°±å›ºå®šäº†ï¼Œæ— æ³•åœ¨è¿è¡Œæ—¶æ”¹å˜ã€‚
> 
>**â“æ—¥å¿—æ–‡ä»¶å¤ªå¤§æœ‰ä»€ä¹ˆé£é™©ï¼Ÿ**
> 
>* å´©æºƒæ¢å¤æ—¶é—´å˜é•¿ã€‚
> 
>* å ç”¨æ›´å¤šç£ç›˜ç©ºé—´ã€‚
> 
>* å¦‚æœç³»ç»Ÿé¢‘ç¹å´©æºƒï¼Œæ¢å¤è¿‡ç¨‹å¯èƒ½å½±å“ä¸šåŠ¡å¯ç”¨æ€§ã€‚
> 
>**â“æ—¥å¿—æ–‡ä»¶å¤ªå°æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ**
> 
>* é¢‘ç¹è§¦å‘æ£€æŸ¥ç‚¹ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚
>* å¯èƒ½å‡ºç° log file full é”™è¯¯ï¼Œé˜»å¡å†™æ“ä½œã€‚
>::: danger è­¦å‘Š
>ä¸Šçº¿åå†ä¿®æ”¹æ­¤å€¼,ä¿®æ”¹å‰åŠ¡å¿…å¤‡ä»½æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶ã€‚äº†è§£ç›¸å…³äº‹å®œ
>:::

### innodb_redo_log_capacity  
<sapn class="marker-evy">é»˜è®¤å€¼:100MBï¼ˆ104,857,600 å­—èŠ‚ï¼‰</sapn>

::: tip  
`innodb_redo_log_capacity`= `innodb_log_file_size * innodb_log_files_in_group`
MySQL8.0.30ä¹‹å‰ï¼ŒInnoDB çš„é‡åšæ—¥å¿—å¤§å°ç”± `innodb_log_file_size` å’Œ `innodb_log_files_in_group` ä¸¤ä¸ªå‚æ•°å…±åŒå†³å®š,
ä» MySQL 8.0.30 å¼€å§‹ï¼Œè¿™ä¸¤ä¸ªå‚æ•°è¢« æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆdeprecatedï¼‰ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯`innodb_redo_log_capacity`
ä½†æ˜¯ä¿ç•™äº†å…¼å®¹,å¦‚æœåŒæ—¶è®¾ç½®äº†æ—§å‚æ•°,é‚£ä¹ˆ `innodb_redo_log_capacity`ä¼˜å…ˆçº§æ›´é«˜
:::

>**åŠ¨æ€æŸ¥çœ‹å’Œä¿®æ”¹**
>````
>SELECT @@innodb_buffer_pool_size AS bytes,ROUND(@@innodb_buffer_pool_size / (1024 * 1024 * 1024), 2) AS GB;
>
># æ³¨æ„ï¼šåŠ¨æ€ä¿®æ”¹æ—¶ï¼ŒMySQL ä¼šè‡ªåŠ¨è¿›è¡Œæ—¥å¿—å½’æ¡£å’Œé‡æ–°åˆ†é…ï¼Œè¿‡ç¨‹æ˜¯ åœ¨çº¿ã€éé˜»å¡ çš„ï¼Œä½†å»ºè®®åœ¨ä½å³°æœŸæ“ä½œ
>SET GLOBAL innodb_redo_log_capacity = 2147483648; -- 2G
>````
>
>**ä½¿ç”¨**
> è‡ªè¡Œå‚è€ƒ 
> `innodb_log_file_size * innodb_log_files_in_group`


### innodb_flush_log_at_trx_commit

<sapn class="marker-evy">é»˜è®¤å€¼:innodb_flush_log_at_trx_commit = 1</sapn>
>**ğŸ“Œä¸€ã€ä½œç”¨**
> 
> **æ§åˆ¶ InnoDB çš„ redologåœ¨äº‹åŠ¡æäº¤æ—¶å¦‚ä½•ä»å†…å­˜åˆ·æ–°åˆ°ç£ç›˜**
> 
> **RedoLog çš„ä½œç”¨**
> * InnoDB ä½¿ç”¨ redo log æ¥ä¿è¯äº‹åŠ¡çš„ æŒä¹…æ€§ï¼ˆDurabilityï¼‰ã€‚ å½“äº‹åŠ¡æäº¤åï¼Œå³ä½¿æ•°æ®åº“å´©æºƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡ redo log æ¢å¤å·²æäº¤çš„äº‹åŠ¡ã€‚
> 
> **ç¼“å†²æœºåˆ¶ï¼š**
> * Redo log é¦–å…ˆå†™å…¥å†…å­˜ä¸­çš„ log bufferï¼Œç„¶åæ ¹æ® innodb_flush_log_at_trx_commit çš„è®¾ç½®å†³å®šä½•æ—¶åˆ·æ–°åˆ°ç£ç›˜ã€‚
>
>**âœ…æ€»ç»“**
>
>| å‚æ•°å€¼  |     è¡Œä¸º      |  å®‰å…¨   |     æ€§èƒ½      |   åœºæ™¯   |
> |:---------------:|-----------|:-----:|:-----------:|:------:|
>| 1   | æ¯æ¬¡æäº¤éƒ½åˆ·ç›˜  | âœ… æœ€é«˜  |âŒ æœ€ä½| é‡‘é¢ç±»æ“ä½œ  |
>| 2  | å†™å…¥ OS ç¼“å­˜ï¼Œæ¯ç§’åˆ·ç›˜ | âš ï¸ ä¸­ç­‰ |âœ… è¾ƒé«˜| æ“ä½œç±»å¿—ç±»  |
>| 0   |   æ¯ç§’åˆ·ç›˜ä¸€æ¬¡   | âŒ æœ€ä½  |âœ… æœ€é«˜| æ“ä½œç±»å¿—ç±» |
>
> sync_binlog=1 + innodb_flush_log_at_trx_commit=1  æœ€é«˜å®‰å…¨æ€§,ç‰ºç‰²æ€§èƒ½
> 
> 
> sync_binlog=1000 + innodb_flush_log_at_trx_commit=2  é«˜æ€§èƒ½,é€‚åˆç”¨æˆ·æ“ä½œç±»è®°å½•ä¸æ•æ„Ÿæ•°æ®
> 
> **ä»£ç ä¸­æœªå¼€å¯äº‹åŠ¡,ä¹Ÿä¼šè§¦å‘å—â“**
> 
> æ˜¯çš„ï¼Œå³ä½¿ä½ æ²¡æœ‰æ˜¾å¼å¼€å¯äº‹åŠ¡ï¼ˆå³æ²¡æœ‰å†™ BEGIN æˆ– START TRANSACTIONï¼‰ï¼Œ
> 
> MySQL ä¹Ÿä¼šè‡ªåŠ¨å°†ä½ çš„å•æ¡ DML è¯­å¥ï¼ˆå¦‚ INSERTã€UPDATEã€DELETEï¼‰å½“ä½œä¸€ä¸ª éšå¼äº‹åŠ¡ï¼ˆimplicit transactionï¼‰
> 
> æ‰€ä»¥ï¼Œåªè¦ä¿®æ”¹äº†æ•°æ®ï¼Œå°±ä¼šè§¦å‘ redo log çš„å†™å…¥å’Œåˆ·æ–°è¡Œä¸ºï¼Œ
> 
> å¹¶ä¸”è¿™ä¸ªè¡Œä¸ºä»ç„¶å— innodb_flush_log_at_trx_commit æ§åˆ¶ã€‚


### innodb_log_buffer_size

<sapn class="marker-evy">8.0+é»˜è®¤å€¼:16m</sapn>
>**æŸ¥è¯¢åŠ¨æ€å€¼**
> ````
>SELECT @@innodb_log_buffer_size AS innodb_log_buffer_size_bytes,
>ROUND(@@innodb_log_buffer_size / (1024*1024), 2) AS innodb_log_buffer_size_MB;
> ````
>**ğŸ“Œä½œç”¨**
>
> * ä½œä¸º redologå†™å…¥ç£ç›˜å‰çš„å†…å­˜ç¼“å†²åŒºï¼Œå‡å°‘é¢‘ç¹çš„ç£ç›˜ I/O,ä½äº MySQL çš„å†…å­˜ä¸­ï¼ˆRAMï¼‰
>
> **å·¥ä½œæµç¨‹ï¼š**
> * äº‹åŠ¡æ‰§è¡Œ UPDATE/INSERT/DELETEã€‚
> * ä¿®æ”¹äº§ç”Ÿçš„ redo log è¢«å†™å…¥ InnoDB Log Bufferï¼ˆå†…å­˜ï¼‰
> * æ ¹æ® innodb_flush_log_at_trx_commit è®¾ç½®ï¼šå†³å®šä½•æ—¶åˆ·ç›˜
> * æœ€ç»ˆç”±æ“ä½œç³»ç»Ÿå°†æ•°æ®å†™å…¥ç£ç›˜ä¸Šçš„ ib_logfile0 å’Œ ib_logfile1
>
>**âœ…æ€»ç»“**
>
>| åœºæ™¯  |     å»ºè®®å€¼| 
> |:---------------:|----------|
>| æ™®é€šåº”ç”¨   | ä¿æŒé»˜è®¤ 16M |
>| å¤§é‡å¤§äº‹åŠ¡	  | 64M ~ 256M | 
>| é«˜å¹¶å‘å†™å…¥ç³»ç»Ÿ	   |  128M ~ 512M  |
>
>âš ï¸ æ³¨æ„ï¼šä¸è¦è®¾ç½®è¿‡å¤§ï¼ˆä¸€èˆ¬ä¸è¶…è¿‡ 512Mï¼‰ï¼Œå¦åˆ™ï¼š
>
>* æµªè´¹å†…å­˜
>* åœ¨æç«¯æƒ…å†µä¸‹ï¼ˆå¦‚å´©æºƒæ¢å¤ï¼‰å¯èƒ½å¯¼è‡´æ¢å¤æ—¶é—´å˜é•¿
>

### innodb_io_capacity

<sapn class="marker-evy">é»˜è®¤å€¼:200</sapn>
>**æŸ¥è¯¢åŠ¨æ€å€¼**
> ````
> SHOW VARIABLES LIKE 'innodb_io_capacity';
> ````
>**ğŸ“Œä½œç”¨**
>
> * å‘Šè¯‰InnoDBåå°ä»»åŠ¡å¯ç”¨çš„ç£ç›˜ I/O èƒ½åŠ›ï¼Œä»è€Œæ§åˆ¶åå°æ“ä½œï¼ˆå¦‚åˆ·æ–°è„é¡µã€åˆå¹¶æ’å…¥ç¼“å†²ï¼‰çš„æ‰§è¡Œé€Ÿåº¦
>
>**âœ…ä¸innodb_io_capacity_max çš„å…³ç³»**
>
> * `innodb_io_capacity`ï¼šæ­£å¸¸æƒ…å†µä¸‹çš„æœ€å¤§ I/O å®¹é‡ã€‚
> * `innodb_io_capacity_max`ï¼šåœ¨è„é¡µç§¯å‹ä¸¥é‡æ—¶å…è®¸çš„å³°å€¼ I/O å®¹é‡ã€‚
> 
>**âœ…æ€»ç»“**
>
>| å­˜å‚¨ç±»å‹	  |     å»ºè®®å€¼| 
> |:---------------:|----------|
>| æ™®é€š SATA æœºæ¢°ç¡¬ç›˜ï¼ˆHDDï¼‰	   |200 ~ 500 |
>| SSD å›ºæ€ç¡¬ç›˜		  | 2000 ~ 4000| 
>| é«˜æ€§èƒ½ NVMe SSD		   |  8000 ~ 20000 æˆ–æ›´é«˜ |
>
>âš ï¸ æ³¨æ„ï¼šä¸è¦ç›²ç›®è®¾ç½®è¿‡é«˜ï¼Œé˜²æ­¢ I/O æŠ¢å å‰å°æŸ¥è¯¢
>
>* æµªè´¹å†…å­˜
>* åœ¨æç«¯æƒ…å†µä¸‹ï¼ˆå¦‚å´©æºƒæ¢å¤ï¼‰å¯èƒ½å¯¼è‡´æ¢å¤æ—¶é—´å˜é•¿
>

### innodb_flush_method

<sapn class="marker-evy">é»˜è®¤å€¼:fdatasync</sapn>
>**æŸ¥è¯¢åŠ¨æ€å€¼**
> ````
> SHOW VARIABLES LIKE 'innodb_flush_method';
> ````
>**ğŸ“Œä½œç”¨**
>
> * è¿™ä¸ªå‚æ•°çš„è®¾ç½®ç›´æ¥å½±å“æ•°æ®åº“çš„æ€§èƒ½ï¼ˆå°¤å…¶æ˜¯å†™å…¥æ€§èƒ½ï¼‰å’Œæ•°æ®çš„å®‰å…¨æ€§ï¼ˆåœ¨ç³»ç»Ÿå´©æºƒæ—¶çš„æ•°æ®ä¸¢å¤±é£é™©ï¼‰ã€‚ä¸åŒçš„è®¾ç½®åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶é…ç½®ä¸‹è¡¨ç°å·®å¼‚å¾ˆå¤§ã€‚
>
>**âœ…å¯é€‰å€¼**
>
> * `fdatasync (é»˜è®¤å€¼)`ï¼šé€‚ç”¨äºå¤§å¤šæ•°é€šç”¨åœºæ™¯ï¼Œå°¤å…¶æ˜¯åœ¨æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®å˜æ›´é¢‘ç¹æˆ–å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚æé«˜çš„ç¯å¢ƒã€‚
> * `O_DSYNC`ï¼šè¾ƒå°‘ä½¿ç”¨ï¼Œé€šå¸¸ç”¨äºç‰¹å®šçš„æ€§èƒ½æµ‹è¯•æˆ–è°ƒè¯•ã€‚
> * `O_DIRECT`ï¼šå¼ºçƒˆæ¨èåœ¨å…·æœ‰è¶³å¤Ÿå†…å­˜å’Œé«˜æ€§èƒ½ç£ç›˜ï¼ˆå¦‚ SSDï¼‰çš„ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚
> * `O_DIRECT_NO_FSYNC`ï¼šä»…ç”¨äºç‰¹å®šçš„æ€§èƒ½æµ‹è¯•æˆ–å¯¹æ•°æ®æŒä¹…æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ã€‚ç»ä¸æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚
> * `littlesync / nosync`ï¼šä»…é™äºæµ‹è¯•ç¯å¢ƒï¼Œç»å¯¹ä¸èƒ½ç”¨äºç”Ÿäº§ã€‚
>
> **âœ…fdatasync ä»‹ç»:**
> * è¿™æ˜¯æœ€é€šç”¨å’Œæœ€å®‰å…¨çš„è®¾ç½®ã€‚å®ƒç¡®ä¿äº†æ•°æ®å’Œå…ƒæ•°æ®çš„å®Œæ•´æ€§ï¼Œä½†å¯èƒ½å› ä¸ºåŒæ­¥å…ƒæ•°æ®è€Œå¸¦æ¥è½»å¾®çš„æ€§èƒ½å¼€
> * InnoDB ä½¿ç”¨ fsync() ç³»ç»Ÿè°ƒç”¨æ¥åˆ·æ–°æ•°æ®æ–‡ä»¶ï¼ˆ.ibdï¼‰ï¼Œä½¿ç”¨ fdatasync() ç³»ç»Ÿè°ƒç”¨æ¥åˆ·æ–°æ—¥å¿—æ–‡ä»¶ï¼ˆib_logfile*ï¼‰ã€‚fsync() å’Œ fdatasync() éƒ½ä¼šå¼ºåˆ¶å°†æ–‡ä»¶æ•°æ®å’Œå…ƒæ•°æ®ï¼ˆå¦‚æ–‡ä»¶å¤§å°ã€ä¿®æ”¹æ—¶é—´ç­‰ï¼‰å†™å…¥æŒä¹…å­˜å‚¨ã€‚
>
> **âœ…O_DIRECT ä»‹ç»:**
> * `é¿å…åŒé‡ç¼“å†²`ï¼šInnoDB è‡ªå·±ç®¡ç†ç¼“å†²æ± ï¼ˆBuffer Poolï¼‰ï¼Œå¦‚æœæ“ä½œç³»ç»Ÿå†ä½¿ç”¨é¡µé¢ç¼“å­˜ï¼Œä¼šé€ æˆå†…å­˜çš„æµªè´¹ï¼ˆåŒä¸€ä»½æ•°æ®åœ¨ Buffer Pool å’Œ Page Cache ä¸­å„æœ‰ä¸€ä»½ï¼‰
> * `å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œå†…å­˜æ‹·è´`ï¼šç»•è¿‡å†…æ ¸ç¼“å­˜å¯ä»¥å‡å°‘ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ã€‚
> * `è¦æ±‚æ›´é«˜çš„ I/O å¸¦å®½`ï¼šæ‰€æœ‰ I/O éƒ½ç›´æ¥æ‰“åˆ°ç£ç›˜ï¼Œå¯¹ç£ç›˜å­ç³»ç»Ÿçš„æ€§èƒ½è¦æ±‚æ›´é«˜ã€‚
> * `å¯èƒ½å¢åŠ ç£ç›˜ I/O`ï¼šå¦‚æœæ“ä½œç³»ç»Ÿç¼“å­˜èƒ½æœ‰æ•ˆå‘½ä¸­ï¼ŒO_DIRECT å¯èƒ½ä¼šå¢åŠ å®é™…çš„ç£ç›˜ I/O é‡ã€‚
> 
>**âœ…æ€»ç»“**
> * innodb_flush_method æ§åˆ¶ InnoDB çš„åº•å±‚ I/O åˆ·æ–°è¡Œä¸ºã€‚
> * é»˜è®¤å€¼æ˜¯ fdatasyncï¼Œå®ƒå®‰å…¨ä¸”å…¼å®¹æ€§å¥½ã€‚
> * `ç”Ÿäº§ç¯å¢ƒæ¨è O_DIRECT` é€šå¸¸æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒé¿å…äº†åŒé‡ç¼“å†²ã€‚
> * é€‰æ‹©å“ªä¸ªå€¼å–å†³äºä½ çš„ç¡¬ä»¶ï¼ˆå°¤å…¶æ˜¯ç£ç›˜ç±»å‹å’Œå†…å­˜å¤§å°ï¼‰ã€æ€§èƒ½éœ€æ±‚å’Œå¯¹æ•°æ®å®‰å…¨æ€§çš„è¦æ±‚ã€‚
> * åœ¨æ›´æ”¹æ­¤è®¾ç½®å‰ï¼ŒåŠ¡å¿…åœ¨æµ‹è¯•ç¯å¢ƒä¸­è¿›è¡Œå……åˆ†çš„è¯„ä¼°ã€‚

### innodb_adaptive_hash_index

<sapn class="marker-evy">é»˜è®¤å€¼:ON</sapn>
>**âœ…ä¼˜ç‚¹**
> 
> * SELECT * FROM orders WHERE order_no = 'ORD2025080001'; è¿™æ ·çš„ç­‰å€¼æŸ¥è¯¢å¤§å¹…æå‡æ€§èƒ½
> * ç¼“å­˜å‘½ä¸­ç‡é«˜,å‡å°‘ B+Tree éå†
> * åªä¸ºçƒ­ç‚¹æ•°æ®åˆ›å»ºå“ˆå¸Œç´¢å¼•
> * å†…å­˜ä½¿ç”¨ä¸è®¿é—®é¢‘ç‡æˆæ­£æ¯”,ä¸ä¼šæ— é™å¢é•¿
>
> **âŒç¼ºç‚¹**
>
> * `é”ç«äº‰é—®é¢˜`,AHI ä½¿ç”¨å…¨å±€é”,é«˜å¹¶å‘(æ¯ç§’)10,000+ æ¬¡ç­‰å€¼æŸ¥è¯¢æ—¶å¯èƒ½æœ‰é—®é¢˜
> * `å†…å­˜å¼€é”€`,å“ˆå¸Œè¡¨å ç”¨é¢å¤–å†…å­˜,çº¦ä¸ºç¼“å†²æ± çš„ 5-10%,åœ¨ 8GB å†…å­˜æœåŠ¡å™¨ä¸Šçº¦ 400-800MB
> * `ç»´æŠ¤å¼€é”€`,æ•°æ®å˜æ›´æ—¶éœ€åŒæ­¥æ›´æ–°å“ˆå¸Œç´¢å¼•,é«˜é¢‘å†™å…¥åœºæ™¯å¯èƒ½å½±å“æ€§èƒ½

>**âœ…æ€»ç»“**
> * `ç”Ÿäº§ç¯å¢ƒå¼€å¯`,åˆ©å¤§äºå¼Š
> * `è¶…é«˜å¹¶å‘å†™å…¥`,å…³é—­
> * `è¯»å†™åˆ†ç¦»`,è¯»åº“å¼€,å†™åº“å…³
> * `éè¯»å†™åˆ†ç¦»`,å¼€å¯å®ƒ,åˆ©å¤§äºå¼Š
>


### innodb_adaptive_hash_index

<sapn class="marker-evy">é»˜è®¤å€¼:ON</sapn>
>**âœ…ä¼˜ç‚¹**
>
> * SELECT * FROM orders WHERE order_no = 'ORD2025080001'; è¿™æ ·çš„ç­‰å€¼æŸ¥è¯¢å¤§å¹…æå‡æ€§èƒ½
> * ç¼“å­˜å‘½ä¸­ç‡é«˜,å‡å°‘ B+Tree éå†
> * åªä¸ºçƒ­ç‚¹æ•°æ®åˆ›å»ºå“ˆå¸Œç´¢å¼•
> * å†…å­˜ä½¿ç”¨ä¸è®¿é—®é¢‘ç‡æˆæ­£æ¯”,ä¸ä¼šæ— é™å¢é•¿
>
> **âŒç¼ºç‚¹**
>
> * `é”ç«äº‰é—®é¢˜`,AHI ä½¿ç”¨å…¨å±€é”,é«˜å¹¶å‘(æ¯ç§’)10,000+ æ¬¡ç­‰å€¼æŸ¥è¯¢æ—¶å¯èƒ½æœ‰é—®é¢˜
> * `å†…å­˜å¼€é”€`,å“ˆå¸Œè¡¨å ç”¨é¢å¤–å†…å­˜,çº¦ä¸ºç¼“å†²æ± çš„ 5-10%,åœ¨ 8GB å†…å­˜æœåŠ¡å™¨ä¸Šçº¦ 400-800MB
> * `ç»´æŠ¤å¼€é”€`,æ•°æ®å˜æ›´æ—¶éœ€åŒæ­¥æ›´æ–°å“ˆå¸Œç´¢å¼•,é«˜é¢‘å†™å…¥åœºæ™¯å¯èƒ½å½±å“æ€§èƒ½

>**âœ…æ€»ç»“**
> * `ç”Ÿäº§ç¯å¢ƒå¼€å¯`,åˆ©å¤§äºå¼Š
> * `è¶…é«˜å¹¶å‘å†™å…¥`,å…³é—­
> * `è¯»å†™åˆ†ç¦»`,è¯»åº“å¼€,å†™åº“å…³
> * `éè¯»å†™åˆ†ç¦»`,å¼€å¯å®ƒ,åˆ©å¤§äºå¼Š
