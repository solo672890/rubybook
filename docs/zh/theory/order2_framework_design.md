---
releaseTime: 2025/8/4
original: true
prev: false
next: false
editLink: false
comment: true

---

# 订单分表后,客户端如何实现不按月份下拉翻页?

> 做项目的时候遇到了这个问题,于是请教了同行,没几个人能说清楚的.
> 
> 估计是用的oracle这样的数据库吧,或者就没遇到需要分库分表的项目
> 
> 没办法,只能自己琢磨了

按照传统的分页查询办法,肯定不行.鬼知道客户在以前的某个月是否有下订单.也不可能每张月份表依次去查询.
经过调研`微信支付,淘宝,支付宝,拼多多`这4款大产品,以及网上一些相关资料,结合个人的分析,判定`不按照月份实现上拉刷新`这个功能挺麻烦的.

## 调研4大产品实现的订单记录下拉分页的表现效果
::: code-group
````[淘宝]
不按月份下拉翻页,每页10条记录,速度极快,即便翻页到10年前,响应速度非常快,

个人分析:
不清楚如何实现,
个人认为并非内存提前加载了所有的记录,有可能提前加载了下一页的数据.
个人猜测并非是分表中间件的功劳,因为这么搞,要吃的内存太多太多了.
有可能是仓(elasticSearch,Clickhouse等)的功劳+提前加载下一页,
也有可能做的是按user_id分库分表,百库百表等+魔改后的mysql.
````
````[pdd]
和淘宝一样
````
````[微信支付]
每页20条记录,按月分表,仅展示最近12个月的交易数据,
超过12个月后的数据,必须选择年月来查询

个人分析:
可能使用数仓工具,增加记录到mysql的月份表同时也增加到数仓里,
数仓(elasticSearch,Clickhouse等)保存最近一年的数据作为分析和查询,
历史数据则作为冷数据,必须按年月查询
````


````[支付包支付记录]
第一页展示了38条记录,第二页展示了20条记录,第三页展示了36条记录,第4页展示了20条记录,
按月分表

个人分析:
这里的38并非是一个固定的数字,是因为8月份刚好只有18条记录,
于是它从7月份取了20条记录补上,所以第一页有了38条数据.
但7月份超过40条记录,即便借给8月份20条,剩下的页足够分页,所以它第二页展示了20条记录
````
:::

## 调研结论
淘宝和拼多多那样的效果固然很好,但是开发,维护成本太高了,不适用中小微企业,也不符合 [RubyBook的宗旨](/theory/whatsRubyBook),

即便中型企业要强上这样的效果,那么也会严重影响工期质量.小微企业就不用说了,就掏不出这样的成本.

所以,接下来我会讲诉如何实现 `微信支付,支付宝支付`的客户端app上拉分页效果



## 遗憾
写到这里的时候我决定放弃编写了,直接union all就完事了.

一开始我曾想过,union all多表联查性能会不好,于是我想过其他比较麻烦的方案来实现,所有就有了这篇文章

但是万万没想到,union all结果超出我的想象, [union all性能测试](/service/mysql#union-all)

直接union all联查6表(半年数据),记得一定要走索引.超过半年的数据,让用户手动选择时间就完事了.

从 union all结果集中做如下操作

1.缓存第一页,避免客户端反复刷新
2.缓存下一页,给用户更好的体验














